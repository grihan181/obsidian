### 1. **Точность один раз (At-most-once)**
**Описание:**
- Сообщение может быть доставлено один раз или не доставлено вовсе.
- В этом режиме Kafka не гарантирует, что сообщение будет доставлено потребителю, и, в случае сбоя, оно может быть потеряно.
- Это наиболее быстрый режим, так как он требует наименьшего количества проверок и подтверждений.

**Настройки:**
- Для обеспечения этой гарантии установите `acks=0` на стороне продюсера, что означает, что продюсер не ждет подтверждения от брокеров.
- Режим `acks=1` также может соответствовать этому уровню гарантии, если брокер не подтверждает получение сообщения и продюсер не получает ответ от брокера.

### 2. **Точность по крайней мере один раз (At-least-once)**
**Описание:**
- Сообщение будет доставлено по крайней мере один раз, но может быть доставлено несколько раз в случае сбоя.
- Это означает, что продюсер и потребитель могут столкнуться с повторной доставкой сообщений, если возникают сбои, так как продюсер может повторно отправить сообщение.

**Настройки:**
- Для достижения этой гарантии установите `acks=1` или `acks=all` на стороне продюсера.
- В случае `acks=1`, продюсер ждет подтверждения от лидера партиции.
- В случае `acks=all`, продюсер ждет подтверждения от всех реплик партиции (включая лидера), что повышает надежность доставки.

**Дополнительно:**
- Используйте настройки продюсера, такие как `retries` и `delivery.timeout.ms`, для управления повторными попытками отправки сообщений и таймаутами.

### 3. **Точность ровно один раз (Exactly-once)**
**Описание:**
- Сообщение будет доставлено точно один раз, без дублирования и потерь.
- Это наиболее строгий уровень гарантии, обеспечивающий, что каждое сообщение будет обработано только один раз, несмотря на сбои или повторные попытки.

**Настройки:**
- Для обеспечения гарантии ровно один раз вам нужно настроить Kafka и ваши приложения должным образом.

**Для продюсера:**
- Используйте настройку `acks=all` и активируйте поддержку транзакций.
- Включите настройку `enable.idempotence=true`, чтобы обеспечить идемпотентность отправки сообщений.

**Для потребителя:**
- Используйте транзакции для обработки сообщений.
- Убедитесь, что обработка сообщений в вашем приложении является идемпотентной (не приводит к побочным эффектам при повторной обработке).
- Включите настройку `isolation.level=read_committed` для обеспечения, что потребитель видит только завершенные транзакции.

### 4. **Гарантии на уровне репликации**

**Описание:**
- Kafka использует механизм репликации для обеспечения устойчивости данных. Каждая партиция имеет один лидер и несколько реплик.
- Если лидер партиции становится недоступен, другой брокер из реплик становится новым лидером, и данные остаются доступными.

**Настройки:**
- Для обеспечения высокой устойчивости, установите `acks=all` на стороне продюсера, что требует подтверждения от всех реплик перед подтверждением сообщения.
- Конфигурация `min.insync.replicas` определяет минимальное количество реплик, которые должны быть синхронизированы для подтверждения записи.
### Как это работает на каждом уровне
#### На уровне продюсера:

- **`acks`:** Управляет тем, сколько брокеров должны подтвердить запись сообщения.
- **`enable.idempotence`:** Предотвращает дублирование сообщений при повторной отправке.
- **`transactional.id`:** Используется для поддержки транзакционных сообщений, обеспечивая точность один раз.
#### На уровне брокера:

- **Репликация:** Брокеры используют механизм репликации для обеспечения устойчивости данных. Каждая партиция имеет лидера и несколько реплик.
- **`min.insync.replicas`:** Параметр указывает минимальное количество реплик, которые должны быть синхронизированы для подтверждения записи.
#### На уровне потребителя:

- **`enable.auto.commit`:** Управляет автоматическим коммитом смещений. Если отключен, потребитель сам управляет смещениями.
- **`isolation.level`:** Устанавливает уровень изоляции чтения сообщений, что важно для обработки транзакционных сообщений.